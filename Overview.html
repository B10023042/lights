<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>慈善亭 | 點燈系統</title>
  <link rel="stylesheet" href="./src/css/headquaters.css">
  <script src="https://www.gstatic.com/firebasejs/4.11.0/firebase.js"></script>
  <script src="https://unpkg.com/vue/dist/vue.js"></script>
  <script src="./dist/vuefire.js"></script>
</head>

<body>

  <div id="app">
    <section id="admin-wrapper">
      <div id="form-wrapper">
        <h1 class="page-title">慈善亭</h1>
        <h1 class="page-title"> <a href="Index.html">新增</a> | <a href="Search.html">搜尋</a> | <a
            href="Overview.html">總覽</a></h1>
        <button v-on:click="loadData">載入資料</button>
      </div>
      <ul>
        <li v-for="data in overviewData">
          <div id="form-wrapper">

            姓名<input :name="data.name" v-model.trim="data.name">
            電話<input :name="data.phone" v-model.trim="data.phone">
            <br>
            生時八字<br>
            <select v-model.trim="data.isChineeseYear" value=data.isChineeseYear>
              　<option value="農曆">農曆</option>
              　<option value="國曆">國曆</option>
            </select>
            民國
            <input :name="data.year" v-model.trim="data.year" id="time">年
            <input :name="data.month" v-model.trim="data.month" id="time">月
            <input :name="data.day" v-model.trim="data.day" id="time">日
            <input :name="data.minute" v-model.trim="data.minute" id="time">時生
            <br>
            地址：<input :name="data.address" v-model.trim="data.address" id="address">
            <br>
            備註：<input :name="data.memo" v-model.trim="data.memo" id="memo">
            <br>
            <button v-on:click="updateUser(data)">更新</button>
            <button v-on:click="removeUser(data)">刪除</button>
            <button v-on:click="copyUser(data)">複製</button>
          </div>
        </li>
      </ul>


    </section>



  </div>

  <script>
    /* global Vue, firebase */

    let config = {
      apiKey: 'AIzaSyBJykOkltgTEmq5bTCA5pxUUCI52Tghx6g',
      authDomain: 'light-1a6d4.firebaseapp.com',
      databaseURL: 'https://light-1a6d4.firebaseio.com/',
      projectId: 'light-1a6d4',
      storageBucket: 'light-1a6d4.appspot.com',
      messagingSenderId: '66654715141'
    }
    this.searchResultData
    let db = firebase.initializeApp(config).database()
    let userRef = db.ref('User')
    new Vue({
      el: '#app',
      data: {

        overviewDataWithKey: {
          key: [],
          user: []
        },
        overviewData: [],
        copyUserData: [],
        addMultipleUserStyle: {
          display: 'none'
        }
      },
      firebase: {
        Users: userRef.limitToLast(25),
      },
      methods: {
        loadData: function () {
          let self = this;
          this.overviewData = []
          userRef.once("value", function (snapshot) {
            let i = 0;
            snapshot.forEach(function (data) {
              if (i < 100) {
                let user = data.val();
                user.key = data.key;
                self.overviewData.push(user);
              }
              i++;
            });
          });
        },
        formatUser: function () {
          let i = 0;
          this.overviewData = []
          for (let i = 0; i < this.overviewDataWithKey.key.length; i++) {
            let userWithKey = {
              user: this.overviewDataWithKey.user[i],
              key: this.overviewDataWithKey.key[i]
            }
            this.overviewData.push(userWithKey);
          }

        },

        updateUser: function (data) {
          data.isAftermoon = '上午';
          data.lightType = '信徒';
          data.hour = 0;
          userRef.child(data.key).set(data.user);
          alert('更新完成')
          location.reload();
        },
        removeUser: function (data) {
          userRef.child(data.key).remove();
          alert('刪除完成')
          location.reload();
        },
        addMultipleUser: function () {
          let self = this;
          if (this.copyUserData) {
            this.copyUserData.forEach(function (user) {
              self.addUserToFirebase(user);
            });
            this.copyUserData = [];
            location.reload();
          }
        },
        addUserToFirebase: function (user) {
          userRef.push({
            name: user.name,
            phone: user.phone,
            address: user.address,
            year: user.year,
            month: user.month,
            day: user.day,
            hour: user.hour,
            minute: user.minute,
            isAftermoon: user.isAftermoon,
            isChineeseYear: user.isChineeseYear,
            lightType: user.lightType,
            lightYear: user.lightYear,
            memo: user.memo,
            modifyTime: Date.now()
          })
        },
      }
    })
  </script>
</body>

</html>